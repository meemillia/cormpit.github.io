/*! For license information please see epics.404ceeb86e009d9c9803.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{2382:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.createPointData=void 0;var a=n(r(28)),o=r(1756),i=["ignoreHistory","withoutRedo"];t.createPointData=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=t.ignoreHistory,u=void 0!==c&&c,l=t.withoutRedo,s=void 0!==l&&l,p=(0,a.default)(t,i);return{date:Date.now(),options:n,ignoreHistory:u,withoutRedo:s,pageId:n.pageId||(0,o.getCurrentPage)(r),action:{type:e,payload:p}}}},2667:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrgFulfilledAction=t.fetchOrgAction=t.FETCH_ORGANIZATION=void 0;var n=r(1698),a="FETCH_ORGANIZATION";t.FETCH_ORGANIZATION=a;t.fetchOrgAction=function(e){return{type:a,payload:e}};t.fetchOrgFulfilledAction=function(e){return{type:(0,n.withFulfilledType)(a),payload:e}}},3142:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.getNewHomepage=t.checkPageAndRedirectHome=void 0;var a=n(r(19)),o=r(2030),i=r(1756),c=r(793),u=e.pipe(e.entries,e.filter((function(e){return!(0,a.default)(e,2)[1].websiteApplication})),e.filter((function(e){return!(0,a.default)(e,2)[1].metadata.parentId})),e.sortBy((function(e){return(0,a.default)(e,2)[1].sortOrder||0})),e.head);t.getNewHomepage=u;t.checkPageAndRedirectHome=function(t,r){var n=t.websiteId,l=t.pages,s=t.location,p=(0,i.getCurrentPage)(r);if(!Object.keys(l).includes(p)){var d=e.findKey((function(e){return e.metadata.homepage}),l)||e.flow(u,e.get("0"))(l),f=s.pathname.match(/\/editor\/(website|structure|comment)\/(.+)/);if(f){var g=(0,a.default)(f,2)[1],v=(0,c.getLanguageFromPath)(),y=v?"/".concat(v):"";return(0,o.replace)("".concat(y,"/editor/").concat(g,"/").concat(n,"/").concat(d).concat(s.search||""))}return null}}}).call(this,r(24))},3143:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getAverageSortOrder=t.SORT_POSITION_TOP=t.SORT_POSITION_BOTTOM=void 0;var n=r(2565);t.SORT_POSITION_TOP="top";t.SORT_POSITION_BOTTOM="bottom";t.getAverageSortOrder=function(t){var r=t.blocks,a=t.position,o=(0,n.sortBlocks)(r);if(!o.length)return 1;if(a>=o.length)return e.pipe(e.last,e.prop(e.__,r),e.prop("sortOrder"),e.add(1))(o);var i=o[a],c=o[a-1];return e.flow(e.compact,e.map((function(e){return r[e].sortOrder})),e.sum)([i,c])/2}}).call(this,r(24))},4377:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.epics=t.default=void 0;var a=n(r(36)),o=r(2031),i=n(r(9321)),c=r(9322),u=r(9323),l=r(9324),s=r(9338),p=r(9355),d=r(9357),f=r(9358),g=r(9359),v=r(9360),y=r(9365),b=r(9367),O=r(9368),h=r(9369),E=r(9370),m=n(r(9371)),P=n(r(3852)),T=n(r(9372)),_=n(r(9373)),w=n(r(9374)),A={editorStatusEpic:h.editorStatusEpic,undoRedoEpic:v.undoRedoEpic,externalUpdateUndo:v.externalUpdateUndo,permissionEpic:c.permissionEpic,changeLocationEpic:u.changeLocationEpic,blocksEpic:s.blocksEpic,pagesEpic:l.pagesEpic,uiKitEpic:p.uiKitEpic,fetchBlockTemplatesEpic:d.fetchBlockTemplatesEpic,fetchViewsEpic:f.fetchViewsEpic,fetchWebsiteEpic:g.fetchWebsiteEpic,fetchOrganizationEpic:E.fetchOrganizationEpic,updateWebsiteEpic:g.updateWebsiteEpic,themesEpic:y.themesEpic,modalsEpic:b.modalsEpic,commentsEpic:O.commentsEpic,getWebsiteAppsEpic:g.getWebsiteAppsEpic,popupsEpic:i.default,popupTemplatesEpic:m.default,ecommerceEpic:P.default,phrasesEpic:T.default,loadingBlocksEpic:_.default,shapeEpic:w.default};t.epics=A;var k=o.combineEpics.apply(void 0,(0,a.default)(Object.values(A)));t.default=k},4378:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.toggleHiddenStatusEpic=t.toggleHiddenRoles=void 0;var o=a(r(36)),i=a(r(19)),c=r(1756),u=r(1702),l=r(1755),s=r(1752),p=r(1719),d=r(1696),f=r(1688),g=r(392),v=r(2260),y=r(1971),b=r(1698),O=e.values(f.DEVICE_HIDDEN_ROLES),h=e.getOr([],"roles"),E=e.cond([[p.isHiddenOnAllDevices,e.pipe(h,e.without(O))],[e.T,e.pipe(h,n.concatRearg(O),e.uniq)]]),m=e.curry((function(t,r){return n.ifElse((0,p.isHiddenOnDeviceType)(t),e.pipe(h,e.without([(0,v.getRoleByDevice)(t)])),e.pipe(h,n.concatRearg((0,v.getRoleByDevice)(t))))(r)})),P=e.curry((function(t,r){return n.ifElse(e.always(e.equals(t,f.ALL_DEVICE_TYPE)),E,m(t))(r)}));t.toggleHiddenRoles=P;t.toggleHiddenStatusEpic=function(t,r){var n=(0,u.makeBlockSelector)();return t.ofType(u.TOGGLE_HIDDEN_STATUS,(0,b.withUndoType)(u.TOGGLE_HIDDEN_STATUS),(0,b.withRedoType)(u.TOGGLE_HIDDEN_STATUS)).withLatestFrom(r).switchMap((function(t){var r=(0,i.default)(t,2),a=r[0].payload,v=a.id,b=a.deviceType,O=r[1],h=e.includes(b,[].concat((0,o.default)(f.ALL_DEVICES),[f.ALL_DEVICE_TYPE]))?b:(0,d.selectCurrentDevice)(O),E=(0,c.getCurrentPage)(O),m=(0,s.getCurrentPage)(O),T=n(O,v);if((0,p.isSpawning)(T)){var _=(0,y.getPushMergeBlocksRoles)(T.anchor,m),w=P(h,{roles:_}),A=(0,y.setPushMergeBlocksRoles)(T.anchor,m,w);return g.Observable.of((0,l.updatePageAction)({pageId:E,data:{merge_blocks:A}},{ignoreHistory:!0}))}var k=P(h,T);return g.Observable.of((0,u.updateBlockAction)(v,{roles:k}))}))}}).call(this,r(24),r(35))},9321:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPopupEpic=t.default=t.closePopupEditorEpic=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(55)),c=r(2259),u=r(544),l=r(2926),s=r(1702),p=r(392),d=r(2567);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=function(t,r){return t.ofType(c.FETCH_POPUP).switchMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,e.next=3,(0,u.getBlockData)(r);case 3:return n=e.sent,o=g(g({},n),{},{id:r,roles:n.roles||[]}),e.next=7,(0,l.buildBlockData)(r,o);case 7:return i=e.sent,e.next=10,(0,l.getAndSetView)(o);case 10:return e.abrupt("return",[(0,s.fetchBlockFulfilledAction)(r,i),(0,d.fetchViewFulfilledAction)(i.viewRef),(0,c.fetchPopupFulfilledAction)(i)]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).switchMap(e.apply(p.Observable.of))};t.fetchPopupEpic=v;var y=function(e,t){return e.ofType(c.CLOSE_POPUP_EDITOR).switchMap((function(){var e=t.value.popups,r=Object.keys(e);return[(0,c.closePopupEditorFulfilledAction)(r)]}))};t.closePopupEditorEpic=y;var b=function(e,t){return p.Observable.merge(v(e),y(e,t))};t.default=b}).call(this,r(24))},9322:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.permissionEpic=void 0;var n=r(2030),a=r(1698),o=[n.LOCATION_CHANGE,n.CALL_HISTORY_METHOD];t.permissionEpic=function(e){return e.filter((function(e){return!(0,a.hasPermission)(e.type)&&!o.includes(e.type)})).map(a.withPermission)}},9323:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changeLocationEpic=void 0;var a=n(r(19)),o=r(392),i=r(2030),c=r(1822),u=r(1755),l=r(1906),s=r(1996),p=r(1702),d=r(1698),f=r(793),g=r(848),v=r(791),y=r(1708);t.changeLocationEpic=function(t,r){return o.Observable.merge(t.ofType(s.START).switchMap((function(){var e=(0,v.getHistory)();return o.Observable.of((0,i.replace)({pathname:e.location.pathname,state:e.location.state}))})),t.ofType(i.LOCATION_CHANGE).withLatestFrom(r).filter((function(t){var r=(0,a.default)(t,2),n=r[0].payload.location.pathname,o=void 0===n?"":n,i=r[1],c=(0,y.pagesSelector)(i);return!e.isEmpty(c)&&!o.includes("/editor/")})).switchMap((function(){return o.Observable.merge(o.Observable.of((0,l.closeAllModalsAction)()),o.Observable.of((0,u.unReadyPageAction)()),o.Observable.of((0,c.cleanWebsiteAction)()),o.Observable.of((0,p.cleanBlocksAction)()))})),t.ofType(s.START).filter((function(){return r.value.auth})).map((function(){return function(t){var r=e.getOr(null,["router","location","pathname"],t),n=r.match(f.LANG_URL_REGEXP),a=n&&e.includes(n[1],g.ACCOUNT_LANGUAGES)?n[1]:null,o=a?"/".concat(a,"/"):"/editor";if(e.startsWith(o,r)){var i=r.split("/");return a?i[4]:i[3]}return null}(r.value)})).switchMap((function(n){return o.Observable.merge(o.Observable.of((0,c.fetchWebsiteAction)(n)),t.ofType((0,d.withPermissionType)((0,d.withFulfilledType)(u.FETCH_PAGES))).switchMap((function(){return o.Observable.merge(o.Observable.of(null),t.ofType(i.LOCATION_CHANGE))})).map((function(){var t=e.get("router.location.pathname")(r.value);return e.last(t.split("/"))})).distinctUntilChanged().withLatestFrom(r).filter((function(e){var t=(0,a.default)(e,2),r=t[0],n=t[1];return(0,y.selectPageById)(r,n)})).map((function(e){var t=(0,a.default)(e,1)[0];return(0,p.fetchBlocksAction)(t)})))})),t.ofType(s.PRE_CHANGE_LOCATION).switchMap((function(e){var r=e.payload,n=r.path,a=r.onPageReadyAction;return o.Observable.merge(o.Observable.of((0,i.push)(n)),t.ofType((0,d.withPermissionType)(u.READY_PAGE)).take(1).map((function(){return a})))})))}}).call(this,r(24))},9324:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pagesEpic=void 0;var n=r(2031),a=r(9325),o=r(9326),i=r(9327),c=r(9328),u=r(9329),l=r(9330),s=r(9331),p=r(9332),d=r(9334),f=r(9336),g=r(9337),v=(0,n.combineEpics)(o.fetchPagesEpic,c.createPageEpic,d.clonePageEpic,p.removePageEpic,l.changePageMetadataEpic,u.changePageOrderEpic,i.externalPageRemoveEpic,s.changePageMetadataPropEpic,a.updatePageEpic,f.setHomepageEpic,g.changePageLangGroupEpic);t.pagesEpic=v},9325:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePageEpic=void 0;var a=n(r(54)),o=n(r(19)),i=n(r(55)),c=r(1755),u=r(1698),l=r(544),s=r(1708),p=r(1718);t.updatePageEpic=function(e,t){return e.ofType(c.UPDATE_PAGE,(0,u.withUndoType)(c.UPDATE_PAGE),(0,u.withRedoType)(c.UPDATE_PAGE)).withLatestFrom(t).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var r,n,i,d,f,g,v;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,o.default)(t,2),n=r[0].payload,i=r[1],d=n.pageId,f=n.data,g=(0,s.pagesSelector)(i),v=(0,p.selectWebsiteId)(i),!g[d]){e.next=15;break}return e.prev=5,e.next=8,(0,l.updateWebsitePage)({websiteId:v,pageId:d,data:f});case 8:return e.abrupt("return",(0,c.updatePageFulfilledAction)({pageId:d,data:f}));case 11:return e.prev=11,e.t0=e.catch(5),console.log("error changing page",e.t0),e.abrupt("return",{type:(0,u.withRejectType)(c.UPDATE_PAGE)});case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean)}},9326:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPagesEpic=void 0;var a=n(r(54)),o=n(r(19)),i=n(r(55)),c=r(1755),u=r(544),l=r(3142),s=r(392),p=r(1996);t.fetchPagesEpic=function(t,r){return t.ofType(c.FETCH_PAGES).withLatestFrom(r).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var r,n,i,s,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,o.default)(t,2),n=r[0].payload.websiteId,i=r[1],e.next=3,(0,u.getWebsitePages)(n);case 3:return s=e.sent,d=(0,p.selectRouterLocation)(i),e.abrupt("return",[(0,c.fetchPagesFulfilledAction)({pages:s}),(0,l.checkPageAndRedirectHome)({websiteId:n,pages:s,location:d},i)].filter(Boolean));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).mergeMap(e.spread(s.Observable.of))}}).call(this,r(24))},9327:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.externalPageRemoveEpic=void 0;var a=n(r(19)),o=r(1865),i=r(1996),c=r(1718),u=r(1708),l=r(3142);t.externalPageRemoveEpic=function(t,r){return t.ofType(o.EXTERNAL_PAGE_REMOVE).withLatestFrom(r).map((function(t){var r=(0,a.default)(t,2),n=r[0].payload.id,o=r[1],s=(0,i.selectRouterLocation)(o),p=(0,c.selectWebsiteId)(o),d=(0,u.pagesSelector)(o);return(0,l.checkPageAndRedirectHome)({websiteId:p,pages:e.omit(n)(d),location:s},o)})).filter(Boolean)}}).call(this,r(24))},9328:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.createPageEpic=void 0;var a=n(r(54)),o=n(r(55)),i=n(r(28)),c=n(r(19)),u=n(r(3)),l=r(1755),s=r(1718),p=r(1752),d=r(392),f=r(544),g=r(1698),v=r(1719),y=r(866),b=r(1817),O=r(1971),h=["_id","slug"];function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.createPageEpic=function(t,r){return t.ofType(l.CREATE_PAGE).mergeMap((function(t){var n=t.payload,a=n.sortOrder,o=n.metadata,u=r.value,g=(0,s.selectWebsiteId)(u),v=(0,p.pagesSelector)(u),y=(0,b.currentLanguageSelector)(u),E=function(e,t){if(t)return e.filter((function(e){return e.lang===t})).every((function(e){return e.roles.includes("hidden")}))?["hidden"]:void 0}(e.values(v),y),P=m({roles:E,metadata:m(m({},o),{},{slug:(0,O.generateUniqSlug)({metadata:o,pages:v,lang:y}),homepage:!1}),sortOrder:a},y&&{lang:y});return d.Observable.fromPromise((0,f.addWebsitePage)({id:g,data:P})).map((function(e){var t=(0,c.default)(e,1)[0],r=t._id,n=t.slug,a=(0,i.default)(t,h);return(0,l.createPageFulfilledAction)({pageId:r,data:m(m(m({},a),P),{},{slug:n,langGroup:a.lang_group})})})).catch((function(){return[]}))})).ofType((0,g.withFulfilledType)(l.CREATE_PAGE)).do(function(){var e=(0,o.default)(a.default.mark((function e(t){var n,o,i,u,l,p,d,g;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload.pageId,o=(0,s.selectWebsiteId)(r.value),i=(0,v.genLocation)(n),e.prev=3,e.next=6,(0,y.getCustomBlock)();case 6:(u=e.sent)&&(l=u._id,p=u.roles,d=(0,c.default)(u.categories,1),g=d[0],(0,f.createBlockOnLocation)({websiteId:o,location:i,source:l,anchorName:g,roles:p,sortOrder:1})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}())}}).call(this,r(24))},9329:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageOrderEpic=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(55)),c=r(1755),u=r(544),l=r(1971);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.changePageOrderEpic=function(e,t){return e.ofType(c.CHANGE_PAGE_ORDER).concatMap(function(){var e=(0,i.default)(a.default.mark((function e(r){var n,o,i,s,d,f,g,v;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.payload,o=n.pages,i=n.changedPage,s=t.value,d=s.website._id,f=s.pages,e.prev=2,g=f[i.id],v={metadata:p(p({},i.metadata),{},{slug:i.metadata.parentId!==g.metadata.parentId?(0,l.generateUniqSlug)({pages:o,metadata:i.metadata,slugId:i.slug,lang:i.lang}):i.metadata.slug}),sortOrder:i.sortOrder},e.next=7,(0,u.updateWebsitePage)({websiteId:d,pageId:i.id,data:v});case 7:return e.abrupt("return",(0,c.changePageOrderFulfilledAction)({changedPage:p(p({},i),v)}));case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",{type:""});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean)}},9330:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataEpic=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(55)),c=r(1755),u=r(1698),l=r(544),s=r(1971);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.changePageMetadataEpic=function(e,t){return e.ofType(c.CHANGE_PAGE_METADATA,(0,u.withUndoType)(c.CHANGE_PAGE_METADATA),(0,u.withRedoType)(c.CHANGE_PAGE_METADATA)).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(r){var n,o,i,p,f,g,v,y,b,O,h;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.payload,o=n.pageId,i=t.value,p=i.pages,f=i.website._id,!p[o]){e.next=18;break}return e.prev=4,g=p[o],v=g.metadata,y=g.slug,b=g.lang,(O=d(d({},v),n.metadata)).parentId!==v.parentId&&(O.slug=(0,s.generateUniqSlug)({metadata:O,pages:p,slugId:y,lang:b})),e.next=10,(0,l.updateWebsitePage)({websiteId:f,pageId:o,data:{metadata:O}});case 10:return h=e.sent,e.abrupt("return",(0,c.changePageMetadataFulfilledAction)(d({pageId:o,metadata:O},h)));case 14:return e.prev=14,e.t0=e.catch(4),console.log("error changing page metadata",e.t0),e.abrupt("return",{type:(0,u.withRejectType)(c.CHANGE_PAGE_METADATA)});case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean)}},9331:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataPropEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(1755),c=r(1698),u=r(544),l=r(392);t.changePageMetadataPropEpic=function(e,t){return e.ofType(i.CHANGE_PAGES_METADATA_PROP,(0,c.withUndoType)(i.CHANGE_PAGES_METADATA_PROP),(0,c.withRedoType)(i.CHANGE_PAGES_METADATA_PROP)).mergeMap(function(){var e=(0,o.default)(a.default.mark((function e(r){var n,o,i,c,l,s,p,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.type,o=r.payload,i=o.key,c=o.value,l=o.pages,s=t.value.website._id,e.prev=2,e.next=5,(0,u.updatePagesMetadataProp)({websiteId:s,key:i,value:c,pages:l});case 5:return p=e.sent,d=p.ok,e.abrupt("return",d&&{type:n,key:i,value:c,pages:l});case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",{type:""});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean).mergeMap((function(e){var t=e.key,r=e.value,n=e.pages;return l.Observable.of((0,i.changePagesMetadataPropFulfilledAction)({key:t,value:r,pages:n})).filter(Boolean)}))}},9332:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.removePageEpic=void 0;var a=n(r(54)),o=n(r(36)),i=n(r(19)),c=n(r(3)),u=n(r(55)),l=r(392),s=r(1755),p=r(544),d=r(1698),f=r(9333),g=r(1940),v=r(1996),y=r(1718),b=r(1708),O=r(1955),h=r(3142);function E(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=function(){var t=(0,u.default)(a.default.mark((function t(r,n,o){var i,c,u,l,s,d,f,v,y,b,O,h,m,P;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(0,g.getPagesBySortOrder)(n).filter((function(e){return e.id!==r})),c=e.filter((function(e){return e.metadata.parentId===n[r].slug}),i),u=e.findIndex({metadata:{parentId:n[r].slug}},i),l=e.findLastIndex({metadata:{parentId:n[r].slug}},i),s=i[u-1],d=i[l+1],f=null,v=null,s&&d?(f=(0,g.getSortOrder)(s),v=(0,g.getSortOrder)(d)):!s&&d?(v=(0,g.getSortOrder)(d),f=v-c.length):s&&!d?(f=(0,g.getSortOrder)(s),v=f+c.length):s||d||(f=0,v=0),y=(v-f)/(c.length+1),b=c.map((function(e,t){var r=f+y*(t+1);return T(T({},e),{},{sortOrder:r,metadata:T(T({},e.metadata),{},{parentId:null})})})),O=E(b),t.prev=12,O.s();case 14:if((h=O.n()).done){t.next=21;break}return m=h.value,P=e.pick(["sortOrder","metadata"],m),t.next=19,(0,p.updateWebsitePage)({websiteId:o,pageId:m.id,data:P});case 19:t.next=14;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(12),O.e(t.t0);case 26:return t.prev=26,O.f(),t.finish(26);case 29:return t.abrupt("return",b);case 30:case"end":return t.stop()}}),t,null,[[12,23,26,29]])})));return function(e,r,n){return t.apply(this,arguments)}}(),w=function(){var t=(0,u.default)(a.default.mark((function t(r,n,o){var i,c,u,l;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e.pipe(e.pickBy((function(e){return e.metadata.parentId===n[r].slug})),e.keys)(n),c=E(i),t.prev=2,c.s();case 4:if((u=c.n()).done){t.next=10;break}return l=u.value,t.next=8,(0,p.removeWebsitePage)({id:o,pageId:l});case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),c.e(t.t0);case 15:return t.prev=15,c.f(),t.finish(15);case 18:return t.abrupt("return",i);case 19:case"end":return t.stop()}}),t,null,[[2,12,15,18]])})));return function(e,r,n){return t.apply(this,arguments)}}();t.removePageEpic=function(t,r){return t.ofType(s.REMOVE_PAGE).withLatestFrom(r).concatMap(function(){var n=(0,u.default)(a.default.mark((function n(c){var u,g,E,m,P,A,k,S,j,C,M,I,R;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=(0,i.default)(c,2),g=u[0].payload,E=g.pageId,m=g.removeSubpages,P=u[1],A=(0,v.selectRouterLocation)(P),k=(0,y.selectWebsiteId)(P),S=(0,b.pagesSelector)(P),S[E]){n.next=7;break}return n.abrupt("return",[]);case 7:return j=[],C=[],n.prev=9,n.next=12,(0,p.removeWebsitePage)({id:k,pageId:E});case 12:if(!m){n.next=18;break}return n.next=15,w(E,S,k);case 15:j=n.sent,n.next=21;break;case 18:return n.next=20,_(E,S,k);case 20:C=n.sent;case 21:n.next=26;break;case 23:return n.prev=23,n.t0=n.catch(9),n.abrupt("return",l.Observable.of({type:""}));case 26:return M=(0,O.isHomepage)(S[E]),I=(0,f.dispatchWaitMergeCreator)(t),R=function(){return l.Observable.of.apply(l.Observable,(0,o.default)(e.compact([(0,h.checkPageAndRedirectHome)({websiteId:k,pages:e.omit([E],S),location:A},P)])))},n.abrupt("return",I((0,s.removePageFulfilledAction)({pageIds:[E].concat((0,o.default)(j)),removeSubpages:m,pagesWithRemovedParent:C}),(0,d.withPermissionType)((0,d.withFulfilledType)(s.REMOVE_PAGE)),(function(){var e=(0,h.getNewHomepage)(r.value.pages);return M?I((0,s.changePageMetadataAction)({pageId:e[0],metadata:T(T({},e[1].metadata),{},{homepage:!0})}),(0,d.withPermissionType)((0,d.withFulfilledType)(s.CHANGE_PAGE_METADATA)),R):R()})));case 30:case"end":return n.stop()}}),n,null,[[9,23]])})));return function(e){return n.apply(this,arguments)}}()).mergeMap(e.identity)}}).call(this,r(24))},9333:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchWaitMergeCreator=void 0;var n=r(392);t.dispatchWaitMergeCreator=function(e){return function(t,r,a){return n.Observable.merge(e.ofType(r).first().mergeMap(a),n.Observable.of(t))}}},9334:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.clonePageEpic=void 0;var o=a(r(54)),i=a(r(3)),c=a(r(36)),u=a(r(55)),l=r(1755),s=r(544),p=r(9335),d=r(1788),f=r(2261),g=r(1971);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b=function(){var e=(0,u.default)(o.default.mark((function e(t,r,n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",void 0);case 2:if(n!==r.lang){e.next=4;break}return e.abrupt("return",(0,s.getNewId)().data());case 4:if(t.find((function(e){return e.lang===n&&e.lang_group===r.lang_group}))){e.next=7;break}return e.abrupt("return",r.lang_group);case 7:return e.abrupt("return",(0,s.getNewId)().data());case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),O=function(e,t,r,n){var a=e.roles,o=void 0===a?[]:a;if(r){var i=(0,f.isHidden)(e);return!(0,d.getLanguageVisibility)(t,{lang:n})&&!i?[].concat((0,c.default)(o),["hidden"]):o.filter((function(e){return"hidden"!==e}))}return o};t.clonePageEpic=function(t,r){return t.ofType(l.CLONE_PAGE).mergeMap(function(){var t=(0,u.default)(o.default.mark((function t(a){var i,c,u,d,v,h,E,m,P,T,_,w,A,k,S,j,C,M,I,R,D,L,B,G,N,x,U;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.payload,c=i.pageId,u=i.data,d=void 0===u?{}:u,v=r.value,h=v.website._id,E=v.pages,m=E[c],P=m.metadata,T=m.metadata.displayName,_=m.lang,w=e.pipe(n.keyToProp("id"),e.sortBy(e.getOr(0,"sortOrder")))(E),A=e.findIndex({id:c},w),k=w[A],S=w[A+1],j=S?(e.getOr(0,"sortOrder",k)+e.getOr(0,"sortOrder",S))/2:e.getOr(0,"sortOrder",k)+1,C=(0,f.getMetadataForClonedPage)(P),M=e.values(E),I=d.lang&&_!==d.lang,R=E[c],D=I?M.find((function(e){return e.lang===d.lang&&e.lang_group===R.lang_group})):null,t.next=15,b(M,R,d.lang);case 15:return L=t.sent,B=O(R,E,I,d.lang),G={roles:B,metadata:y(y({},C),{},{slug:I&&!D?P.slug:(0,g.generateUniqSlug)({metadata:C,pages:E,lang:I?d.lang:_}),displayName:(0,p.generateDuplicateName)(I?M.filter((function(e){return e.lang===d.lang})):M,T,"metadata.displayName"),parentId:I?null:e.getOr(null,"parentId",C)}),sortOrder:j,lang:d.lang?d.lang:_,langGroup:L,merge_blocks:R.merge_blocks},t.prev=18,t.next=21,(0,s.cloneWebsitePage)({id:h,data:G,pageId:c});case 21:return N=t.sent,x=N.pageId,U=N.slug,t.abrupt("return",(0,l.createPageFulfilledAction)({pageId:x,data:y(y({},G),{},{slug:U,lang_group:L,langGroup:L,website_lang:R.website_lang})}));case 27:return t.prev=27,t.t0=t.catch(18),t.abrupt("return",{type:""});case 30:case"end":return t.stop()}}),t,null,[[18,27]])})));return function(e){return t.apply(this,arguments)}}())}}).call(this,r(24),r(35))},9335:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.generateDuplicateName=void 0;var a=n(r(19));t.generateDuplicateName=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",o="copy",i=-1,c=new RegExp("^".concat(r,"(\\s").concat(o,"(\\s\\d+)?)?$"));return e.forEach((function(t){var r=e.get(n,t).match(c)||[],o=(0,a.default)(r,3),u=o[0],l=o[1],s=o[2];s?i=Math.max(i,s):i<1&&l?i=1:i<0&&u&&(i=0)}))(t),i<0?r:"".concat(r," ").concat(o).concat(i?" ".concat(i+1):"")}}).call(this,r(24))},9336:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.setHomepageEpic=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(55)),c=r(1708),u=r(544),l=r(1698);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.setHomepageEpic=function(t,r){return t.ofType(c.SET_HOMEPAGE).mergeMap(function(){var t=(0,i.default)(a.default.mark((function t(n){var o,i,s,d,f,g,v,y,b;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.payload.pageId,i=(0,c.pagesSelector)(r.value),s=r.value.website._id,d=i[o],f=e.values(i),g=f.find(e.get("metadata.homepage")),v=g.langGroup,t.next=9,(0,u.getNewId)().data();case 9:if(y=t.sent,t.prev=10,d.lang!==d.website_lang){t.next=17;break}return t.next=14,(0,u.updateWebsitePage)({websiteId:s,pageId:g._id,data:{lang_group:y}});case 14:return t.next=16,(0,u.updateWebsitePage)({websiteId:s,pageId:o,data:{lang_group:v,metadata:p(p({},d.metadata),{},{homepage:!0})}});case 16:return t.abrupt("return",(0,c.setHomepageFulfilledAction)({pageId:o,oldPageId:g._id,homepageLangGroup:v,oldPageNewLangGroup:y,realHomepage:!0}));case 17:return b=f.find((function(e){return e.lang===d.lang&&e.langGroup===v})),t.next=20,(0,u.updateWebsitePage)({websiteId:s,pageId:b._id,data:{lang_group:y}});case 20:return t.next=22,(0,u.updateWebsitePage)({websiteId:s,pageId:o,data:{lang_group:v}});case 22:return t.abrupt("return",(0,c.setHomepageFulfilledAction)({pageId:o,oldPageId:b._id,homepageLangGroup:v,oldPageNewLangGroup:y}));case 25:return t.prev=25,t.t0=t.catch(10),t.abrupt("return",{type:(0,l.withRejectType)(c.SET_HOMEPAGE)});case 28:case"end":return t.stop()}}),t,null,[[10,25]])})));return function(e){return t.apply(this,arguments)}}())}}).call(this,r(24))},9337:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageLangGroupEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(1755),c=r(1698),u=r(544);t.changePageLangGroupEpic=function(e,t){return e.ofType(i.CHANGE_PAGE_LANG_GROUP,(0,c.withUndoType)(i.CHANGE_PAGE_LANG_GROUP),(0,c.withRedoType)(i.CHANGE_PAGE_LANG_GROUP)).mergeMap(function(){var e=(0,o.default)(a.default.mark((function e(r){var n,o,l,s,p,d,f;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.payload,o=n.selectedPageId,l=n.pageId,s=n.langGroup,p=t.value,d=p.pages,f=p.website._id,e.prev=3,e.t0=o&&d[o],!e.t0){e.next=8;break}return e.next=8,(0,u.updateWebsitePage)({websiteId:f,pageId:o,data:{lang_group:null}});case 8:if(e.t1=l&&d[l],!e.t1){e.next=12;break}return e.next=12,(0,u.updateWebsitePage)({websiteId:f,pageId:l,data:{lang_group:s}});case 12:return e.abrupt("return",(0,i.changePageLangGroupFulfilledAction)({selectedPageId:o,pageId:l,langGroup:s}));case 15:return e.prev=15,e.t2=e.catch(3),console.log("error changing page",e.t2),e.abrupt("return",{type:(0,c.withRejectType)(i.CHANGE_PAGE_LANG_GROUP)});case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean)}},9338:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blocksEpic=void 0;var n=r(2031),a=r(9339),o=r(9340),i=r(2926),c=r(9343),u=r(9344),l=r(9345),s=r(4378),p=r(9348),d=r(9350),f=r(9351),g=r(9352),v=r(9353),y=r(9354),b=(0,n.combineEpics)(a.changeSortOrderEpic,o.createBlockEpic,i.fetchBlocksEpic,c.cloneBlockEpic,u.cloneBlockToPagesEpic,l.cloneBlockToLanguagesEpic,s.toggleHiddenStatusEpic,p.toggleHiddenStatusOnAllPagesEpic,d.removeBlockEpic,f.serverUpdateBlockEpic,y.updateBlockModifierEpic,g.updateBlockEpic,v.updateToSourceEpic);t.blocksEpic=b},9339:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeSortOrderEpic=void 0;var n=r(1698),a=r(1702),o=r(2565);t.changeSortOrderEpic=function(t,r){return t.ofType(a.CHANGE_SORT_ORDER,(0,n.withRedoType)(a.CHANGE_SORT_ORDER),(0,n.withUndoType)(a.CHANGE_SORT_ORDER)).switchMap((function(t){var n,i=t.payload,c=i.id,u=i.targetId,l=i.position,s=r.value.blocks,p=s[u];return p?(n="before"===l?(0,o.calcNewOrders)(c,"decrease",e.set("".concat(c,".sortOrder"),p.sortOrder+1e-4,s)):(0,o.calcNewOrders)(c,"increase",e.set("".concat(c,".sortOrder"),p.sortOrder-1e-4,s)),Object.keys(n).map((function(e){var t=n[e];return(0,a.updateBlockFulfilledAction)(e,{sortOrder:t})}))):[]}))}}).call(this,r(24))},9340:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockEpic=void 0;var o=a(r(54)),i=a(r(36)),c=a(r(19)),u=a(r(3)),l=a(r(28)),s=a(r(55)),p=r(392),d=r(1702),f=r(1755),g=r(1752),v=r(1971),y=r(1822),b=r(1906),O=r(9341),h=r(1917),E=r(1844),m=r(820),P=r(544),T=r(1962),_=r(3846),w=r(1693),A=r(1698),k=r(2909),S=r(3143),j=["location","categories","position","sortOrder","anchorName","askLocation","noScroll","roles"];function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=e.propSatisfies("roles",n.includes("removed")),R=function(e){var t=e.location,r=e.pageBlocks,a=e.position;return n.startsWith("WebsitePage:",t)?(0,S.getAverageSortOrder)({blocks:r,position:a}):0};t.createBlockEpic=function(t,r){return t.ofType(d.CREATE_BLOCK).mergeMap(function(){var a=(0,s.default)(o.default.mark((function a(u){var S,C,D,L,B,G,N,x,U,H,F,W,K,V,Y,q,z,J,X,Z,$,Q,ee,te,re,ne,ae,oe,ie,ce,ue,le,se,pe,de,fe,ge,ve,ye,be,Oe,he,Ee,me,Pe,Te,_e;return o.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return S=u.payload,C=S.source,D=S.createBlockProps,L=D.location,B=D.categories,G=D.position,N=D.sortOrder,x=D.anchorName,U=D.askLocation,H=D.noScroll,F=D.roles,W=(0,l.default)(D,j),K=S.isTargetGlobalBlock,a.prev=1,V=r.value,Y=(0,T.incrementAnchor)({anchorName:x,blocks:V.blocks,categories:B,roles:F}),q=V.blocks,z=n.pickBy(n.propEq("location",L),q),H||("header"===L?J=0:"footer"===L?J=document.body.getBoundingClientRect().height:(X=n.size(z),Z=G===n.size(z)||G===Number.POSITIVE_INFINITY,($=X?n.pipe(e.keyToProp("id"),n.sortBy("sortOrder"),n.nth(Math.min(X-1,Z?G-1:G)))(z):n.find(n.propEq("location","header"),q))&&(Q=document.getElementById(I($)?"block-removed-".concat($.id):"blockId-".concat($.id)),ee=Q?Q.getBoundingClientRect():0,te=ee.top,re=ee.bottom,ne="header"===$.location||Z?re:te,J=ne+window.scrollY-100))),ae=n.path(["website","_id"])(V),a.next=10,(0,P.createBlockOnLocation)(M(M({},W),{},{anchorName:Y,source:C,websiteId:ae,location:L,sortOrder:N||R({location:L,pageBlocks:z,position:G}),roles:F}));case 10:return oe=a.sent,ie=oe.block,ce=oe.block,ue=ce.id,le=ce.anchor,se=ce.source,pe=null,de=[],K&&se&&(fe=(0,g.getCurrentPage)(V),ge=(0,d.makeBlockSelector)()(V,se),ve=ge.anchor,ye=n.pipe(n.map((function(e){var t=(0,v.getPushMergeBlocksRoles)(ve,e);if(n.isEmpty(t))return null;var r=(0,v.setPushMergeBlocksRoles)(le,e,t);return(0,f.updatePageAction)({pageId:e.id,data:{merge_blocks:r}},{ignoreHistory:!0})})),n.compact)(n.values((0,g.currentLangPagesSelector)(V))),pe=n.find(n.pipe(n.get("payload.pageId"),n.equals(fe.id)),ye),de=n.reject(pe,ye)),be=(0,_.getAppsByRoles)(ie.roles),Oe=[],be.forEach((function(e){var t=e.application;Oe.push((0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.installAndSetApp)({websiteId:ae,application:t,type:"editor"});case 2:"blog"===t&&((0,E.trigger)("blog_installed_feed"),(0,m.pushEvent)({event:"Blog Connected",eventCategory:"Apps",eventAction:"Blog",eventLabel:"Connected"}));case 3:case"end":return e.stop()}}),e)})))())})),a.prev=22,a.next=25,Promise.all(Oe);case 25:a.next=30;break;case 27:a.prev=27,a.t0=a.catch(22),console.error(a.t0);case 30:return a.next=32,(0,k.getBlockContent)(ie);case 32:if(he=a.sent,Ee=r.value.router.location.pathname,me=L.split(":"),Pe=(0,c.default)(me,2),!(Te=Pe[1])||Ee.match(Te)){a.next=37;break}return a.abrupt("return",[]);case 37:return null!=J&&setTimeout((function(){return(0,w.smoothyScrollTo)(J,400,"easeInOutCirc")}),0),_e=p.Observable.of.apply(p.Observable,(0,i.default)(de).concat([(0,b.closeAllModalsAction)(),(0,d.createBlockFulfilledAction)(ue,M(M(M({},W),ie),{},{content:he,anchorName:Y})),U&&(0,b.openModalAction)({id:O.BindedBlockModal.id,props:{location:U,roles:ie.roles,blockId:ue}}),(0,y.getWebsiteAppsAction)()])).filter(Boolean),a.abrupt("return",pe?p.Observable.merge(p.Observable.of(pe),t.ofType((0,A.withPermissionType)((0,A.withFulfilledType)(f.UPDATE_PAGE))).take(1).mergeMap((function(){return _e}))):_e);case 42:return a.prev=42,a.t1=a.catch(1),a.abrupt("return",[]);case 45:case"end":return a.stop()}}),a,null,[[1,42],[22,27]])})));return function(e){return a.apply(this,arguments)}}()).switchMap(n.identity)}}).call(this,r(35),r(24))},9341:function(e,t,r){"use strict";(function(e,n,a){var o=r(5),i=r(17);Object.defineProperty(t,"__esModule",{value:!0}),t.BindedBlockModal=void 0;var c=o(r(54)),u=o(r(310)),l=o(r(66)),s=o(r(114)),p=o(r(80)),d=o(r(55)),f=r(0),g=r(1675),v=r(1681),y=r(1702),b=r(256),O=r(1693),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=a?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(n,o,c):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(1680)),E=r(1708),m=r(1788),P=o(r(9342));function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}var _={header:(0,b.getStringByKey)("add-header-block"),footer:(0,b.getStringByKey)("add-footer-block")},w=a.compose(v.registerModal,(0,h.default)((0,h.asMapDispatch)((function(e){return{updateBlockAction:function(t,r,n){var a=r.location,o=r.roles;return e((0,y.updateBlockAction)(t,{location:a,roles:o},n))}}}))))((function(t){var r=t.blockId,a=t.location,o=t.roles,i=t.closeModal,v=t.updateBlockAction,y=(0,g.useSelector)(E.selectCurrentPageLanguage),h=(0,f.useCallback)((0,d.default)(c.default.mark((function e(){var t;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"header"===a?t=0:"footer"===a&&(t=document.body.getBoundingClientRect().height),v(r,{location:a,roles:(0,m.withLangRole)(y,o)}),i(),setTimeout((function(){return(0,O.smoothyScrollTo)(t,300)}),0);case 4:case"end":return e.stop()}}),e)}))),[r,i,y,a,o,v]);return e.createElement(u.default,{onClose:i,title:"".concat((0,b.getStringByKey)("title-add-to-all-pages"),"?"),notDraggable:!0,withOverlay:!0},e.createElement("div",{className:n(P.default.container,"px-16 pb-24 pt-16")},e.createElement(p.default,null,_[a]),e.createElement(l.default,{mixClassName:"mt-16"},e.createElement(s.default,{className:"primary size-small",mixClassName:"mr-8",onClick:h},(0,b.getStringByKey)("add-to-all-pages")),e.createElement(s.default,{className:"size-small",onClick:i},(0,b.getStringByKey)("only-to-this-page")))))}));t.BindedBlockModal=w}).call(this,r(0),r(16),r(24))},9342:function(e,t,r){"use strict";r.r(t),t.default={container:"container_O4O"}},9343:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockEpic=void 0;var o=a(r(3)),i=a(r(19)),c=r(1702),u=r(1752),l=r(1971),s=r(2032),p=r(1719),d=r(1756);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=["content","modifier","name","roles","categories","anchorName"];t.cloneBlockEpic=function(t,r){return t.ofType(c.CLONE_BLOCK).filter((function(t){var n=t.payload.id;return e.pipe((function(e){return(0,c.makeBlockSelector)()(e,n)}),e.overEvery(e.negate(p.isGlobalFooter),e.negate(p.isRemoved)))(r.value)})).withLatestFrom(r).map((function(t){var r=(0,i.default)(t,2),a=r[0].payload,o=a.id,f=a.location,y=r[1],b=(0,c.makeBlockSelector)()(y,o),O=(0,u.getCurrentPage)(y),h=(0,d.getCurrentPage)(y),E=(0,s.selectOwnBlocksByPageId)(h,y),m=(0,p.isGlobalHeader)(b),P="header"===f,T=e.pipe(e.pick(v),n.when(e.always(m&&!P),e.set("roles",function(t,r){return e.filter(e.negate(e.startsWith("@lang:")),e.uniq(e.concat(e.get("roles",t),(0,l.getPushMergeBlocksRoles)(t.anchor,r))))}(b,O))))(b),_=e.pipe(e.get("sortOrder"),e.add(1))(b),w=e.pipe(e.values,e.sortBy("sortOrder"),e.findIndex(e.propEq("id",o)),e.add(1))(E),A=g(g({location:f||(0,p.genLocation)(h)},P?{sortOrder:_}:{position:w}),T);return(0,c.createBlockAction)(o,A,P)}))}}).call(this,r(24),r(35))},9344:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockToPagesEpic=void 0;var a=n(r(3)),o=n(r(28)),i=r(392),c=r(1887),u=r(256),l=r(1702),s=r(1962),p=r(3143),d=r(1756),f=r(1719),g=r(1996),v=r(2178),y=r(1718),b=r(800),O=["categories","anchorName","askLocation"];function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.cloneBlockToPagesEpic=function(t,r){return t.ofType(l.CLONE_BLOCK_TO_PAGES).mergeMap((function(t){var n=t.payload,a=n.source,h=n.targetPageIds,m=n.createBlockProps,P=m.categories,T=m.anchorName,_=(m.askLocation,(0,o.default)(m,O)),w=r.value,A=(0,y.selectWebsiteId)(w);if(function(t,r){return e.allPass([e.pipe(e.size,e.isEqual(1)),e.negate(e.includes(t))])(r)}((0,d.getCurrentPage)(w),h)){var k=e.first(h),S=(0,u.getStringByKey)("language-route-prefix"),j=(0,v.selectIsDraftium)(w),C="".concat("en"===S?"":S)+"".concat((0,c.getEditorInnerLink)("".concat(j?"structure":"website","/").concat(A,"/").concat(k)));return i.Observable.of((0,g.preChangeLocationAction)({path:C,onPageReadyAction:(0,l.createBlockAction)(a,E(E({},_),{},{location:(0,f.genLocation)(k),anchorName:T,categories:P,sortOrder:p.SORT_POSITION_BOTTOM}))}))}var M=(0,s.incrementAnchor)({anchorName:T,blocks:w.blocks,categories:P}),I=E(E({},_),{},{anchorName:M,categories:P}),R=e.pipe(e.size,e.isEqual(1))(h),D=h.map((function(e){var t=(0,f.genLocation)(e);return(0,l.createBlockAction)(a,E({location:t,sortOrder:p.SORT_POSITION_BOTTOM,noScroll:!R},I))}));return R||(0,b.addToaster)({type:"success",timer:3e3,message:(0,u.getStringByKey)("copy-block-to-pages-success")}),i.Observable.from(D)}))}}).call(this,r(24))},9345:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"cloneBlockToLanguagesEpic",{enumerable:!0,get:function(){return a.default}});var a=n(r(9346))},9346:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(28)),c=n(r(19)),u=n(r(55)),l=n(r(550)),s=r(1702),p=r(1718),d=r(392),f=r(800),g=r(544),v=r(1708),y=r(1996),b=r(1887),O=r(2047),h=r(1788),E=r(9347),m=["roles","location"];function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=function(t,r){return t.ofType(s.CLONE_BLOCK_TO_LANGUAGES).withLatestFrom(r).switchMap(function(){var t=(0,u.default)(a.default.mark((function t(r){var n,o,u,P,_,w,A,k,S,j,C,M,I,R,D,L,B,G,N,x,U,H;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,c.default)(r,2),o=n[0],u=n[1],P=o.payload,_=P.source,w=P.targetLanguages,A=P.createBlockProps,k=A.roles,S=A.location,j=(0,i.default)(A,m),C=(0,p.selectWebsiteId)(u),M=(0,v.homepageSelector)(u),I=(0,v.selectPagesByLangGroup)(M.langGroup,u),t.next=7,(0,g.getBlocksByLocations)(["header","footer"],C,{roles:{$ne:"removed"}});case 7:if(R=t.sent,D=e.filter(e.pipe(e.get("location"),e.equals(S)),R),!e.pipe(e.size,e.isEqual(1))(w)){t.next=18;break}return L=e.first(w),B=l.default.t("language-route-prefix"),G=(0,E.isBlockExistsOnLanguage)(L,D),N=(0,E.findPageByLang)(L,I),x=(0,O.selectIsDraftium)(u),U=e.pipe(e.concat((0,E.withEntityType)(x)),e.join("/"),b.getEditorInnerLink,(0,E.maybeWithLangPrefix)(B))([C,N.id]),t.abrupt("return",d.Observable.of((0,y.preChangeLocationAction)({path:U,onPageReadyAction:(0,s.createBlockAction)(_,T({roles:(0,E.getNewRoles)(G,L,k),location:(0,E.maybeGenLocation)(G,N,S),sortOrder:(0,E.getSortOrder)(S)},j))})));case 18:return H=e.pipe(e.map((function(e){var t=(0,E.isBlockExistsOnLanguage)(e,D),r=(0,E.findPageByLang)(e,I);return(0,s.createBlockAction)(_,T({roles:(0,E.getNewRoles)(t,e,k),location:(0,E.maybeGenLocation)(t,r,S),sortOrder:(0,E.getSortOrder)(S)},j))})))(w),(0,f.addToaster)({type:"success",eventId:"copy-block-to-another-language",timer:3e3,message:l.default.t("copy-block-to-another-language-success",{languages:e.pipe(e.map((function(e){return(0,h.formatLanguageCode)(e)})),e.join(", "))(w)}),unique:!0}),t.abrupt("return",d.Observable.from(H));case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).switchMap(e.identity)};t.default=_}).call(this,r(24))},9347:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.withEntityType=t.maybeWithLangPrefix=t.maybeGenLocation=t.isBlockExistsOnLanguage=t.getSortOrder=t.getNewRoles=t.findPageByLang=void 0;var a=r(1719),o=r(1788),i=r(3143),c=e.curry((function(t,r){return e.pipe(e.some(e.pipe(e.get("roles"),e.includes("@lang:".concat(t)))))(r)}));t.isBlockExistsOnLanguage=c;var u=e.curry((function(t,r){return e.pipe(e.find(e.pipe(e.get("lang"),e.eq(t))))(r)}));t.findPageByLang=u;t.getNewRoles=function(t,r,a){return e.pipe(o.withoutLangRoles,n.unless(e.always(t),(0,o.withLangRole)(r)))(a)};var l=e.curry((function(t,r,o){return n.when(e.always(t),e.always((0,a.genLocation)(r.id)))(o)}));t.maybeGenLocation=l;t.getSortOrder=function(e){return(0,a.isGlobalHeader)({location:e})?i.SORT_POSITION_TOP:i.SORT_POSITION_BOTTOM};var s=e.curry((function(e,t){return"".concat("en"===e?"":e).concat(t)}));t.maybeWithLangPrefix=s;t.withEntityType=function(e){return e?"structure":"website"}}).call(this,r(24),r(35))},9348:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"toggleHiddenStatusOnAllPagesEpic",{enumerable:!0,get:function(){return n.toggleHiddenStatusOnAllPagesEpic}});var n=r(9349)},9349:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.toggleHiddenStatusOnAllPagesEpic=void 0;var a=n(r(36)),o=n(r(19)),i=r(392),c=r(1702),u=r(1719),l=r(1708),s=r(800),p=r(256),d=r(1953),f=r(1989),g=r(1971),v=r(1698),y=r(1688),b=r(1696),O=r(1756),h=r(4125),E=r(4378);t.toggleHiddenStatusOnAllPagesEpic=function(t,r){var n=(0,c.makeBlockSelector)();return t.ofType(c.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,(0,v.withUndoType)(c.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES),(0,v.withRedoType)(c.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)).withLatestFrom(r).switchMap((function(t){var r=(0,o.default)(t,2),m=r[0],P=m.type,T=m.payload,_=T.blockId,w=T.deviceType,A=T.pages,k=T.isHidden,S=r[1],j=(0,O.getCurrentPage)(S),C=A[j],M=n(S,_),I=(0,u.mergeBlockPropsFromPage)(C,M);if(e.negate(u.isSpawning)(M))return[];var R=e.includes(w,[].concat((0,a.default)(y.ALL_DEVICES),[y.ALL_DEVICE_TYPE]))?w:(0,b.selectCurrentDevice)(S),D=(0,h.getPageIdsToToggle)({currentPageId:j,isHidden:k,anchor:I.anchor,deviceType:R,pages:A});if(!D.length)return[];var L=(0,v.withUndoType)(c.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)===P;L||(0,s.addToaster)({eventId:"blockVisibility",message:(0,p.getStringByKey)("we-have-changed-the-block-visibility"),actionConfig:{type:"custom",text:(0,p.getStringByKey)("undo"),icon:{name:"undo-ico"},onClick:function(){var e=(0,d.getStore)(),t=(0,c.selectBlocks)(S);(0,f.undoAction)(e.dispatch)(t,{actionToUndo:(0,c.toggleHiddenStatusOnAllPagesAction)({blockId:_,deviceType:w,pages:A,isHidden:k})})}},type:"success",unique:!0,timer:5e3});var B=e.map((function(t){var r=A[t],n=r.merge_blocks;if(!L){var a=R===y.ALL_DEVICE_TYPE&&!k,o=(0,g.getPushMergeBlocksRoles)(I.anchor,r),i=a?[]:e.sortBy(e.identity,(0,E.toggleHiddenRoles)(R,{roles:o}));n=(0,g.setPushMergeBlocksRoles)(I.anchor,r,i)}return(0,l.updatePageAction)({pageId:t,data:{merge_blocks:n}},{ignoreHistory:!0})}))(D);return i.Observable.from(B)}))}}).call(this,r(24))},9350:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.removeBlockEpic=void 0;var a=n(r(54)),o=n(r(36)),i=n(r(55)),c=r(1702),u=r(1698);t.removeBlockEpic=function(t,r){return t.ofType(c.REMOVE_BLOCK,(0,u.withUndoType)(c.REMOVE_BLOCK)).mergeMap(function(){var t=(0,i.default)(a.default.mark((function t(n){var i,u;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.payload.id,u=e.get(["blocks",i,"roles"])(r.value)||[],t.abrupt("return",(0,c.removeBlockFulfilledAction)(i,{roles:[].concat((0,o.default)(u),["removed"])}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}).call(this,r(24))},9351:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.serverUpdateBlockEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(392),c=r(2357),u=r(2627),l=r(1698),s=r(1702),p=r(544),d=n(r(3626));t.serverUpdateBlockEpic=function(t,r){var n=function(e){return r.value.blocks[e]},f=function(t){return e.get(["blocks",t])(r.value)},g=(0,l.withPermissionType)((0,l.withFulfilledType)(s.UPDATE_BLOCK)),v=(0,l.withPermissionType)((0,l.withFulfilledType)(s.REMOVE_BLOCK)),y={};return t.ofType(g,v).filter((function(e){return!e.payload.block.__TESTUPDATE__})).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(i){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.default.lock((0,o.default)(a.default.mark((function t(){var l,s,d,g;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=i.payload,s=l.block,d=l.id,(g=y[d]=y[d]||{last:Promise.resolve(),nextArgs:i}).nextArgs=i,t.next=5,g.last.catch((function(){}));case 5:return g.nextArgs===i&&(g.last=(0,o.default)(a.default.mark((function t(){var o,l,v,b;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,o=e.pick(e.keys(s)),v=o(n(d));case 3:return l=v,t.next=6,(0,p.updateBlock)({id:d,data:l,websiteId:e.get("website._id")(r.value)});case 6:v=o(n(d));case 7:if(!e.isEqual(l)(v)){t.next=3;break}case 8:t.next=22;break;case 10:return t.prev=10,t.t0=t.catch(0),t.prev=12,t.next=15,f(d);case 15:return b=t.sent,t.abrupt("return",[b]);case 19:return t.prev=19,t.t1=t.catch(12),t.abrupt("return",[]);case 22:return t.prev=22,g.nextArgs===i&&([u.READY,u.LOADING].includes((0,c.getEditorStatus)())||(0,c.changeEditorStatus)(u.SAVED),delete y[d]),t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[0,10,22,25],[12,19]])})))()),t.abrupt("return",g.last);case 7:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).mergeMap(e.spread(i.Observable.of))}}).call(this,r(24))},9352:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.updateBlockEpic=t.getTagsToUpdate=void 0;var o=a(r(3)),i=r(392),c=r(1698),u=(r(1755),r(1702));function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p="try_it_free",d=e.pipe(e.get("content.__constructor__.nodes"),e.any(e.propEq("type","TryItFree"))),f=function(t,r){return e.pipe(e.get("tags"),n.ifElse(e.always(t),e.pipe(n.push(p),e.uniq),e.pull(p)))(r)};t.getTagsToUpdate=f;t.updateBlockEpic=function(e,t){var r=(0,u.makeBlockSelector)();return e.ofType(u.UPDATE_BLOCK,(0,c.withRedoType)(u.UPDATE_BLOCK),(0,c.withUndoType)(u.UPDATE_BLOCK)).mergeMap((function(n){var a=n.payload,o=a.id,l=a.block,p=a.onUpdateBlockAction,g=n.type,v=d(l),y=r(t.value,o),b=f(v,y);return i.Observable.merge(i.Observable.of((0,c.withPermission)((0,u.updateBlockFulfilledAction)(o,s(s({},l),{},{tags:b}),g))).filter(Boolean),e.ofType((0,c.withPermissionType)((0,c.withFulfilledType)(u.UPDATE_BLOCK))).take(1).do((function(){return p&&p()})).ignoreElements())}))}}).call(this,r(24),r(35))},9353:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.updateToSourceEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(1702),c=r(544),u=r(1698);t.updateToSourceEpic=function(e){return e.ofType(i.UPDATE_TO_SOURCE,(0,u.withUndoType)(i.UPDATE_TO_SOURCE),(0,u.withRedoType)(i.UPDATE_TO_SOURCE)).switchMap(function(){var e=(0,o.default)(a.default.mark((function e(t){var r,n,o,u,l,s,p,d,f,g;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=r.id,o=r.sourceVersion,u=r.sourceId,e.next=3,(0,c.updateBlockToSource)({id:n,sourceId:u,sourceVersion:o});case 3:return l=e.sent,s=l.viewRef,p=l.version,d=l.name,f=l.source,g=l.roles,e.abrupt("return",(0,i.updateToSourceFulfilledAction)({id:n,viewRef:s,version:p,name:d,source:f,roles:g}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},9354:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.updateBlockModifierEpic=void 0;var a=n(r(3)),o=n(r(19)),i=r(1702),c=r(2094);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.updateBlockModifierEpic=function(t,r){var n=(0,i.makeBlockSelector)();return t.ofType(i.UPDATE_BLOCK_MODIFIER).withLatestFrom(r).map((function(t){var r=(0,o.default)(t,2),a=r[0].payload,u=a.id,s=a.prop,p=a.value,d=r[1],f=n(d,u),g=f.modifier,v=f.viewRef,y=JSON.parse(g||null);if(!e.isEqual(e.get(s,y),p)){var b=(0,c.getView)(v),O=e.getOr({},"modifierScheme",b),h=e.getOr(e.noop,[s,"join"])(O),E=e.set(s,p,y);return(0,i.updateBlockAction)(u,{modifier:JSON.stringify(l(l({},E),h(E)))})}})).filter(Boolean)}}).call(this,r(24))},9355:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uiKitEpic=void 0;var n=r(2031),a=r(9356),o=r(3850),i=r(3848),c=(0,n.combineEpics)(a.changeCurrentUiKitPreset,o.changePaletteColorsEpic,o.updateWebsiteColorsEpic,i.fetchUIKitEpic,a.changeCurrentUikitTypography,o.changeTypographySettingsEpic,o.updateWebsiteTypographyEpic,a.changeCurrentUikitButtonPreset,o.changeButtonSettingsEpic,o.externalChangeButton,o.externalChangePalette,o.externalChangeTypography);t.uiKitEpic=c},9356:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.changeCurrentUikitTypography=t.changeCurrentUikitButtonPreset=t.changeCurrentUiKitPreset=void 0;var a=n(r(54)),o=n(r(3)),i=n(r(55)),c=r(392),u=r(2326),l=r(1822),s=r(544),p=r(1748),d=r(2502),f=r(2264),g=r(2503),v=r(1698);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.changeCurrentUiKitPreset=function(t,r){return t.ofType(l.CHANGE_CURRENT_PRESET,(0,v.withRedoType)(l.CHANGE_CURRENT_PRESET),(0,v.withUndoType)(l.CHANGE_CURRENT_PRESET)).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var n,o,i,f,g,v,y,O,h,E,m;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,o=n.id,i=n.previousSelection,e.prev=1,f=r.value.website,g=f.uikitTypography,v=f.uikitButton,y=f._id,e.next=5,(0,s.updateWebsite)({id:y,data:{uikitPalette:o},payload:{type:"uikit"}});case 5:return O=e.sent,h=O.uikitPalette,e.next=9,(0,d.getColorPalette)({id:h});case 9:return E=e.sent,m=(0,p.generateUIKit)({uikitTypography:g,uikitButton:v,uikitPalette:E}),e.abrupt("return",c.Observable.of((0,l.changeCurrentPresetFulfilledAction)(b(b({},E),{},{previousSelection:i})),(0,u.fetchUIKitFulfilledAction)(m)));case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}()).switchMap(e.identity)};t.changeCurrentUikitTypography=function(t,r){return t.ofType(l.CHANGE_CURRENT_TYPOGRAPHY,(0,v.withRedoType)(l.CHANGE_CURRENT_TYPOGRAPHY),(0,v.withUndoType)(l.CHANGE_CURRENT_TYPOGRAPHY)).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var n,o,i,d,g,v,y,b,O;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload.id,e.prev=1,o=r.value.website,i=o.uikitButton,d=o.uikitPalette,g=o._id,e.next=5,(0,s.updateWebsite)({id:g,data:{uikitTypography:n},payload:{type:"uikit"}});case 5:return v=e.sent,y=v.uikitTypography,e.next=9,(0,f.getTypographyPreset)({id:y});case 9:return b=e.sent,O=(0,p.generateUIKit)({uikitTypography:b,uikitButton:i,uikitPalette:d}),(0,p.loadGoogleFontsFromUiKit)(O),e.abrupt("return",c.Observable.of((0,l.changeCurrentTypographyFulfilledAction)(b),(0,u.fetchUIKitFulfilledAction)(O)));case 15:return e.prev=15,e.t0=e.catch(1),e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}()).switchMap(e.identity)};t.changeCurrentUikitButtonPreset=function(t,r){return t.ofType(l.CHANGE_CURRENT_BUTTON_PRESET).mergeMap(function(){var e=(0,i.default)(a.default.mark((function e(t){var n,o,i,d,f,v,y,b,O;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload.id,e.prev=1,o=r.value.website,i=o.uikitTypography,d=o.uikitPalette,f=o._id,e.next=5,(0,s.updateWebsite)({id:f,data:{uikitButton:n},payload:{type:"uikit"}});case 5:return v=e.sent,y=v.uikitButton,e.next=9,(0,g.getButtonPreset)({id:y});case 9:return b=e.sent,O=(0,p.generateUIKit)({uikitTypography:i,uikitButton:b,uikitPalette:d}),(0,p.loadGoogleFontsFromUiKit)(O),e.abrupt("return",c.Observable.of((0,l.changeCurrentButtonPresetFulfilledAction)(b),(0,u.fetchUIKitFulfilledAction)(O)));case 15:return e.prev=15,e.t0=e.catch(1),e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}()).switchMap(e.identity)}}).call(this,r(24))},9357:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBlockTemplatesEpic=void 0;var n=r(392),a=r(2917),o=r(544);t.fetchBlockTemplatesEpic=function(e){return e.ofType(a.FETCH_BLOCK_TEMPLATES).mergeMap((function(e){var t=e.payload.filter;return n.Observable.fromPromise((0,o.getBlockTemplates)(t)).map((function(e){return(0,a.fetchBlockTemplatesFulfilledAction)({blockTemplates:e})}))}))}},9358:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchViewsEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(392),c=r(2094),u=r(4130),l=r(2567),s=n(r(2911)),p=n(r(3911));t.fetchViewsEpic=function(t){return t.ofType(l.FETCH_VIEW).distinct(e.path(["payload","viewRef"])).mergeMap(function(){var e=(0,o.default)(a.default.mark((function e(t){var r,n,o,i,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=r.viewRef,r.pageId,o=r.view,e.next=3,(0,u.getView)(n,o);case 3:return i=e.sent,d=i.styles,(0,c.setView)(n,(0,s.default)(d)((0,p.default)(i))),e.abrupt("return",[(0,l.fetchViewFulfilledAction)(n)].filter(Boolean));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).switchMap(e.apply(i.Observable.of))}}).call(this,r(24))},9359:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.updateWebsiteEpic=t.getWebsiteAppsEpic=t.fetchWebsiteEpic=void 0;var o=a(r(54)),i=a(r(55)),c=r(1887),u=r(1892),l=r(1822),s=r(1755),p=r(2303),d=r(2667),f=r(2329),g=r(1917),v=r(544),y=r(3024);t.fetchWebsiteEpic=function(t,r){return t.ofType(l.FETCH_WEBSITE).filter((function(e){return e.payload.websiteId})).switchMap(function(){var t=(0,i.default)(o.default.mark((function t(a){var i,u,b,O,h,E,m;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.payload,u=a.payload.websiteId,window.websiteId=u,b={},t.prev=3,t.next=6,(0,v.getWebsiteById)(u);case 6:return b=t.sent,t.next=9,(0,v.getWebsitePublishedDomains)(u);case 9:b.publishedDomains=t.sent,O=(b.roles||[]).includes("structure"),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(3),console.error(t.t0),t.abrupt("return",[]);case 17:if(h=r.value.builderType,!(b.roles||[]).includes("future")){t.next=21;break}return(0,c.redirectTo)(O?"prototype":"website"),t.abrupt("return",[]);case 21:if(E="comment"===h,m=e.pipe(e.concat([(0,l.fetchWebsiteFulfilledAction)(b),(0,f.fetchCoreThemeAction)(),(0,f.fetchPublicThemesAction)(),(0,f.fetchWebsiteThemeAction)(),(0,s.fetchPagesAction)(i),(0,p.fetchCommentsAction)(u),(0,d.fetchOrgAction)()]),n.unless(e.always(E),e.concat([(0,y.fetchLastCustomShapeTypeAction)(u)])))([]),b.history||E){t.next=26;break}return t.next=26,(0,v.removeBlocks)(b._id).catch(e.noop);case 26:if(t.t1=!E,!t.t1){t.next=30;break}return t.next=30,(0,g.registerWebsiteApps)(b,"editor");case 30:return t.abrupt("return",m);case 31:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(e){return t.apply(this,arguments)}}()).mergeMap(e.identity)};t.getWebsiteAppsEpic=function(e,t){return e.ofType(l.GET_WEBSITE_APPS).switchMap((0,i.default)(o.default.mark((function e(){var r,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.value.website._id,e.prev=1,e.next=4,(0,u.getWebsiteApps)({id:r});case 4:return n=e.sent,e.abrupt("return",(0,l.updateWebsiteFulfilled)({apps:n}));case 8:e.prev=8,e.t0=e.catch(1),console.log("cant update website");case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))))};t.updateWebsiteEpic=function(e,t){return e.ofType(l.UPDATE_WEBSITE).switchMap(function(){var e=(0,i.default)(o.default.mark((function e(r){var n,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.payload,a=t.value.website._id,e.prev=2,e.next=5,(0,v.updateWebsite)({id:a,data:n});case 5:return e.abrupt("return",(0,l.updateWebsiteFulfilled)(n));case 8:e.prev=8,e.t0=e.catch(2),console.log("cant update website");case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean)}}).call(this,r(24),r(35))},9360:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.undoRedoEpic=t.externalUpdateUndo=void 0;var a=n(r(28)),o=n(r(3)),i=r(2031),c=r(2030),u=r(392),l=r(1702),s=r(1755),p=r(1822),d=r(1865),f=r(1698),g=r(2565),v=r(1989),y=r(2382),b=n(r(9361)),O=n(r(9362)),h=n(r(9363)),E=n(r(9364)),m=["value"],P=["value"];function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.payload,o=a.id,i=a.ignoreHistory,c=e.get(["blocks",o])(r),u=c.anchorName,s=c.content,p=void 0===s?null:s,d=c.modifier,f=void 0===d?"":d,g=c.roles,v=c.location;return(0,y.createPointData)(l.UPDATE_BLOCK,{id:o,block:_({content:p,modifier:f,anchorName:u,roles:g||[],location:v},n),ignoreHistory:i},r,{location:v})};t.externalUpdateUndo=function(e){return e.ofType(d.EXTERNAL_UPDATE).map((function(){(0,v.resetUndoStack)(),(0,v.resetRedoStack)(),(0,v.notifySubs)()})).filter(Boolean)};var A=(0,i.combineEpics)(b.default,O.default,E.default,h.default,(function(t,r){return u.Observable.merge(t.ofType(l.UPDATE_BLOCK,l.REMOVE_BLOCK).do((function(e){(0,v.addUndoPoint)(w(e,r.value))})),t.ofType((0,f.withUndoType)(l.UPDATE_BLOCK),(0,f.withUndoType)(l.REMOVE_BLOCK)).do((function(e){(0,v.addRedoPoint)(w(e,r.value))})),t.ofType(l.CHANGE_SORT_ORDER,(0,f.withUndoType)(l.CHANGE_SORT_ORDER)).do((function(e){var t,n,a=e.payload.id,o=r.value.blocks,i=(0,g.sortBlocks)(o),c=i.indexOf(a);c===i.length-1?(t=i[c-1],n="after"):(t=i[c+1],n="before");var u=(0,y.createPointData)(l.CHANGE_SORT_ORDER,{id:a,targetId:t,position:n},{scrollToBlockId:t});e.type===l.CHANGE_SORT_ORDER?(0,v.addUndoPoint)(u):e.type===(0,f.withUndoType)(l.CHANGE_SORT_ORDER)&&(0,v.addRedoPoint)(u)})),t.ofType((0,f.withFulfilledType)(l.CREATE_BLOCK)).do((function(e){var t=e.payload.id;(0,v.addUndoPoint)((0,y.createPointData)(l.REMOVE_BLOCK,{id:t},r.value))})),t.ofType(p.CHANGE_CURRENT_PRESET).do((function(e){var t=r.value,n=e.payload,a=n.previousSelection,o=n.id,i=t.website.uikitPalette,c={id:a,previousSelection:o,color:i.color,source:i.source};(0,v.addUndoPoint)((0,y.createPointData)(a?(0,f.extractUndoRedoActionType)(e.type):p.CHANGE_PALETTE_COLORS,c,t,{noScroll:!0}))})),t.ofType((0,f.withUndoType)(p.CHANGE_CURRENT_PRESET)).do((function(e){var t=r.value,n=t.website.uikitPalette,a=n.color,o=n.source,i=e.payload,c=i.previousSelection,u=i.id;(0,v.addRedoPoint)((0,y.createPointData)((0,f.extractUndoRedoActionType)(e.type),{id:c,previousSelection:u,color:a,source:o},t,{noScroll:!0}))})),t.ofType(p.CHANGE_PALETTE_COLORS).do((function(){var e=r.value,t=e.website.uikitPalette.color;(0,v.addUndoPoint)((0,y.createPointData)(p.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))})),t.ofType((0,f.withUndoType)(p.CHANGE_PALETTE_COLORS)).do((function(){var e=r.value,t=e.website.uikitPalette.color;(0,v.addRedoPoint)((0,y.createPointData)(p.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))})),t.ofType(c.LOCATION_CHANGE).map((function(e){var t=e.payload.location;return{pathname:t.pathname,state:t.state}})).distinctUntilChanged(e.isEqual).do((function(t){var r=t.pathname,n=t.state;n&&n.previewPath||(0,v.changePage)(e.pipe(e.split("/"),e.last)(r))})),t.ofType(s.CHANGE_PAGES_METADATA_PROP).do((function(e){var t=e.payload,n=t.value,o=(0,a.default)(t,m),i=e.meta.ignoreHistory;(0,v.addUndoPoint)((0,y.createPointData)(s.CHANGE_PAGES_METADATA_PROP,_(_({value:!n},o),{},{ignoreHistory:i}),r.value,{noScroll:!0}))})),t.ofType((0,f.withUndoType)(s.CHANGE_PAGES_METADATA_PROP)).do((function(e){var t=e.payload,n=t.value,o=(0,a.default)(t,P);(0,v.addRedoPoint)((0,y.createPointData)(s.CHANGE_PAGES_METADATA_PROP,_({value:!n},o),r.value,{noScroll:!0}))})),t.ofType(l.UPDATE_TO_SOURCE).do((function(t){var n=t.payload,a=n.id,o=n.sourceId,i=r.value,c=e.get("blocks[".concat(a,"].source._id"),i);if(c!==o){var u=e.get("block[".concat(c,"]"),i);(0,v.addUndoPoint)((0,y.createPointData)(l.UPDATE_TO_SOURCE,{id:a,sourceId:c,sourceVersion:u},i))}})),t.ofType((0,f.withUndoType)(l.UPDATE_TO_SOURCE)).do((function(t){var n=t.payload,a=n.id,o=n.sourceId,i=r.value,c=e.get("blocks[".concat(a,"].source._id"),i);if(c!==o){var u=e.get("block[".concat(c,"]"),i);(0,v.addRedoPoint)((0,y.createPointData)(l.UPDATE_TO_SOURCE,{id:a,sourceId:c,sourceVersion:u},i))}})),t.ofType(s.REMOVE_PAGE).do((function(e){var t=e.payload.pageId;(0,v.filterStacks)({pageId:t})}))).filter(e.F)}));t.undoRedoEpic=A}).call(this,r(24))},9361:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(19)),o=r(1708),i=r(1989),c=r(1698),u=r(392),l=r(2382),s=function(t,r){return u.Observable.merge(t.ofType(o.UPDATE_PAGE).withLatestFrom(r).do((function(t){var r=(0,a.default)(t,2),n=r[0],c=n.payload,u=c.pageId,s=c.data,p=n.meta.ignoreHistory,d=r[1],f=d.pages[u],g=e.keys(s),v=e.pick(g,f),y=(0,l.createPointData)(o.UPDATE_PAGE,{pageId:u,data:v,ignoreHistory:p},d,{noScroll:!0});(0,i.addUndoPoint)(y)})),t.ofType((0,c.withUndoType)(o.UPDATE_PAGE)).withLatestFrom(r).do((function(t){var r=(0,a.default)(t,2),n=r[0],c=n.payload,u=c.pageId,s=c.data,p=n.meta.ignoreHistory,d=r[1],f=d.pages[u],g=e.keys(s),v=e.pick(g,f),y=(0,l.createPointData)(o.UPDATE_PAGE,{ignoreHistory:p,pageId:u,data:v},d,{noScroll:!0});(0,i.addRedoPoint)(y)}))).filter(e.F)};t.default=s}).call(this,r(24))},9362:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(19)),o=r(1702),i=r(2382),c=r(1989),u=r(1698),l=r(392),s=function(t,r){return l.Observable.merge(t.ofType(o.TOGGLE_HIDDEN_STATUS).withLatestFrom(r).do((function(e){var t=(0,a.default)(e,2),r=t[0].payload,n=r.id,u=r.deviceType,l=t[1],s=(0,i.createPointData)(o.TOGGLE_HIDDEN_STATUS,{id:n,deviceType:u},l,{noScroll:!0});(0,c.addUndoPoint)(s)})),t.ofType((0,u.withUndoType)(o.TOGGLE_HIDDEN_STATUS)).withLatestFrom(r).do((function(e){var t=(0,a.default)(e,2),r=t[0].payload,n=r.id,u=r.deviceType,l=t[1],s=(0,i.createPointData)(o.TOGGLE_HIDDEN_STATUS,{id:n,deviceType:u},l,{noScroll:!0});(0,c.addRedoPoint)(s)}))).filter(e.F)};t.default=s}).call(this,r(24))},9363:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(19)),o=r(1708),i=r(1989),c=r(2382),u=r(1698),l=r(392),s=function(t,r){return l.Observable.merge(t.ofType(o.CHANGE_PAGE_METADATA).withLatestFrom(r).do((function(t){var r=(0,a.default)(t,2),n=r[0],u=n.payload,l=u.pageId,s=u.metadata,p=n.meta.ignoreHistory,d=r[1],f=e.path([l,"metadata"])(d.pages),g=e.findKey(e.path(["metadata","homepage"]),d.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([f,s])&&(0,i.addUndoPoint)((0,c.createPointData)(o.CHANGE_PAGE_METADATA,{pageId:l,metadata:f,ignoreHistory:p},d,{noScroll:!0,pageId:l})),s.homepage&&s.homepage!==f.homepage&&g&&(0,i.addUndoPoint)((0,c.createPointData)(o.CHANGE_PAGE_METADATA,{pageId:g,metadata:d.pages[g].metadata,ignoreHistory:p},d,{noScroll:!0}))})),t.ofType((0,u.withUndoType)(o.CHANGE_PAGE_METADATA)).withLatestFrom(r).do((function(t){var r=(0,a.default)(t,2),n=r[0].payload,u=n.pageId,l=n.metadata,s=r[1];if(s.pages[u]){var p=e.path([u,"metadata"],s.pages),d=e.findKey(e.path(["metadata","homepage"]),s.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([p,l])&&(0,i.addRedoPoint)((0,c.createPointData)(o.CHANGE_PAGE_METADATA,{pageId:u,metadata:p},s,{noScroll:!0,pageId:u})),l.homepage&&l.homepage!==p.homepage&&d&&(0,i.addRedoPoint)((0,c.createPointData)(o.CHANGE_PAGE_METADATA,{pageId:d,metadata:s.pages[d].metadata},s,{noScroll:!0}))}}))).filter(e.F)};t.default=s}).call(this,r(24))},9364:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(19)),o=r(392),i=r(1702),c=r(2382),u=r(1989),l=r(1698),s=function(t,r){return o.Observable.merge(t.ofType(i.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES).withLatestFrom(r).do((function(e){var t=(0,a.default)(e,2),r=t[0].payload,n=r.blockId,o=r.deviceType,l=r.pages,s=r.isHidden,p=t[1],d=(0,c.createPointData)(i.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,{blockId:n,deviceType:o,pages:l,isHidden:s},p,{noScroll:!0});(0,u.addUndoPoint)(d)})),t.ofType((0,l.withUndoType)(i.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)).withLatestFrom(r).do((function(e){var t=(0,a.default)(e,2),r=t[0].payload,n=r.blockId,o=r.deviceType,l=r.pages,s=r.isHidden,p=t[1],d=(0,c.createPointData)(i.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,{blockId:n,deviceType:o,pages:l,isHidden:s},p,{noScroll:!0});(0,u.addRedoPoint)(d)}))).filter(e.F)};t.default=s}).call(this,r(24))},9365:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.themesEpic=void 0;var o=a(r(54)),i=a(r(3)),c=a(r(36)),u=a(r(19)),l=a(r(55)),s=r(392),p=r(2329),d=r(544),f=r(2325),g=r(9366);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.themesEpic=function(t,r){return s.Observable.merge(t.ofType(p.FETCH_PUBLIC_THEMES).switchMap((0,l.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getPublicThemes)();case 2:return t=e.sent,e.abrupt("return",(0,p.fetchPublicThemesFulfilledAction)({themes:t}));case 4:case"end":return e.stop()}}),e)})))),t.ofType(p.FETCH_CORE_THEME).switchMap((0,l.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s.Observable,e.t1=p.fetchCoreThemeFulfilledAction,e.next=4,(0,d.getCoreTheme)();case 4:if(e.t2=e.sent,e.t2){e.next=7;break}e.t2=null;case 7:return e.t3=e.t2,e.t4={theme:e.t3},e.t5=(0,e.t1)(e.t4),e.abrupt("return",e.t0.of.call(e.t0,e.t5));case 11:case"end":return e.stop()}}),e)})))).switchMap(e.identity),t.ofType(p.FETCH_WEBSITE_THEME).switchMap((0,l.default)(o.default.mark((function t(){var a,i,l,f,g;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.getWebsiteThemes)(e.get("website._id")(r.value));case 2:return a=t.sent,i=e.pipe(n.keyToProp("id"),e.sortBy(e.pipe(e.prop("createdAt"),n.construct(Date))),e.juxt([e.last,e.initial]))(a),l=(0,u.default)(i,2),f=l[0],g=l[1],t.abrupt("return",s.Observable.of.apply(s.Observable,[(0,p.fetchWebsiteThemeFulfilledAction)({theme:f||null})].concat((0,c.default)(e.map(p.removeThemeAction,g)))));case 5:case"end":return t.stop()}}),t)})))).switchMap(e.identity),t.ofType(p.USE_PUBLIC_THEME).switchMap(function(){var t=(0,l.default)(o.default.mark((function t(n){var a,i,u,l,f;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.payload.id,i=r.value,u=e.get("themes.websiteTheme.id")(i),l=e.get("website._id")(i),t.next=6,(0,d.createTheme)({websiteId:l,source:a});case 6:return f=t.sent,t.abrupt("return",s.Observable.of.apply(s.Observable,(0,c.default)(e.compact([(0,p.usePublicThemeFulfilledAction)(f),u&&(0,p.removeThemeAction)({id:u})]))));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).switchMap(e.identity),t.ofType(p.REMOVE_THEME).switchMap(function(){var e=(0,l.default)(o.default.mark((function e(t){var r,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload.id,e.next=3,(0,d.removeTheme)(r);case 3:return n=e.sent,e.abrupt("return",(0,p.removeThemeFulfilledAction)(y({id:r},n)));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.ofType(p.UPDATE_THEME_TO_SOURCE).switchMap(function(){var e=(0,l.default)(o.default.mark((function e(t){var r,n,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=r.id,a=r.sourceId,e.t0=p.updateThemeToSourceFulfilledAction,e.next=4,(0,d.updateBlockToSource)({id:n,sourceId:a});case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.ofType(p.FETCH_THEME_RENDERER).distinct(e.get("payload.viewRef")).mergeMap(function(){var e=(0,l.default)(o.default.mark((function e(t){var r,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload.viewRef,e.next=3,(0,g.getTheme)(r);case 3:return n=e.sent,(0,f.setTheme)(r,n),e.abrupt("return",(0,p.fetchThemeRendererFulfilledAction)({viewRef:r}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}}).call(this,r(24),r(35))},9366:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTheme=void 0;var n=r(3855),a=function(e){if("weblium/editor"===e)return r(4131);throw new Error("Invalid required path ".concat(e))};t.getTheme=function(e){return(0,n.buildTheme)({viewRef:e,requireInjector:a})}},9367:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.modalsEpic=void 0;var o=a(r(3)),i=r(392),c=r(1906),u=r(1681),l=r(791);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.modalsEpic=function(t){return i.Observable.merge(t.filter(e.propSatisfies("type",n.anyPass([n.endsWith("@UNDO_PROCEED"),n.endsWith("@REDO_PROCEED")]))).mergeMap((function(){return i.Observable.of((0,c.closeAllModalsAction)())})),t.ofType(c.CLOSE_ALL_MODALS).mergeMap((function(){var e=(n.filter("hash",(0,u.getOpenedModals)())[0]||{}).hash,t=(0,l.getHistory)();return t.location.hash===e&&t.push(p(p({},t.location),(0,u.getSavedLocation)())),i.Observable.of((0,c.closeAllModalsActionFulfilled)())})))}}).call(this,r(35),r(24))},9368:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.commentsEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(392),c=r(2303),u=r(544);function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=function(t){return function(r){return r?e.update("block.ref",t)(r):r}};t.commentsEpic=function(t,r){return i.Observable.merge(t.ofType(c.FETCH_COMMENTS).switchMap(function(){var e=(0,o.default)(a.default.mark((function e(t){var r,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload.websiteId,e.prev=1,e.next=4,(0,u.fetchComments)(r);case 4:return n=e.sent,e.abrupt("return",(0,c.fetchCommentsFulfilledAction)(n));case 8:return e.prev=8,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",(0,c.fetchCommentsFulfilledAction)([]));case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()),t.ofType(c.ADD_COMMENT_CONFIRM).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(n){var o,i,l,s,d,f,g,v,y;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.payload,i=o.comment,l=o.tempId,s=r.value,d=s.website._id,f=s.blocks,g=e.flow(e.omit(["id","active","pinNumber"]),e.update("location",p((function(e){return e?e._id:e}))))(i),t.prev=3,t.next=6,(0,u.addComment)({comment:g,websiteId:d});case 6:return v=t.sent,y=e.update("location",p((function(t){return{_id:t,roles:e.getOr([],"".concat(t,".roles"))(f)}})))(v),t.abrupt("return",(0,c.addCommentConfirmFulfilledAction)(l,y));case 11:return t.prev=11,t.t0=t.catch(3),t.abrupt("return",(0,c.addCommentConfirmRejectAction)(l));case 14:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}()),t.ofType(c.ADD_AND_POST_COMMENT).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(n){var o,i,l,s,d,f,g,v,y,b,O;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.payload,i=o.comment,l=o.commentToPost,s=r.value,d=s.website._id,f=s.blocks,g=l.id,v=l.tempId,y=e.flow(e.omit(["id","tempId","inProgress","active","pinNumber"]),e.update("location",p((function(e){return e?e._id:e}))))(l),t.prev=4,t.next=7,(0,u.addComment)({comment:y,websiteId:d});case 7:return b=t.sent,O=e.update("location",p((function(t){return{_id:t,roles:e.getOr([],"".concat(t,".roles"))(f)}})))(b),t.abrupt("return",(0,c.addAndPostCommentFulfilledAction)(i,O,v));case 12:return t.prev=12,t.t0=t.catch(4),t.abrupt("return",(0,c.addCommentConfirmRejectAction)(g));case 15:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e){return t.apply(this,arguments)}}()),t.ofType(c.UPDATE_COMMENT).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(n){var o,i,l,s,p,d;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.payload,i=o.id,l=o.comment,s=o.newId,!l.inProgress){t.next=3;break}return t.abrupt("return",(0,c.updateCommentFulfilledAction)(i,l,s));case 3:return t.prev=3,p=e.flow(e.pick(["location","text"]),e.update("location.block.ref",(function(e){return e?e._id:e})))(l),d=r.value.website._id,t.next=8,(0,u.updateComment)({id:i,data:p,websiteId:d});case 8:return t.abrupt("return",(0,c.updateCommentFulfilledAction)(i,l));case 11:t.prev=11,t.t0=t.catch(3),console.log("comment update error",t.t0);case 14:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}()).filter(Boolean),t.ofType(c.RESOLVE_COMMENT).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(n){var o,i,l;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.payload.id,i=r.value.website._id,l=r.value.comments,!e.find((function(e){return e.id===o}))(l)){t.next=14;break}return t.prev=5,t.next=8,(0,u.resolveComment)({id:o,websiteId:i});case 8:return t.abrupt("return",(0,c.resolveCommentFulfilledAction)(o));case 11:t.prev=11,t.t0=t.catch(5),console.log("comment resolve error",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])})));return function(e){return t.apply(this,arguments)}}()).filter(Boolean),t.ofType(c.UNRESOLVE_COMMENT).mergeMap(function(){var t=(0,o.default)(a.default.mark((function t(n){var o,i,l,s;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.payload.id,i=r.value,l=i.comments,s=i.website._id,!e.find((function(e){return e.id===o}))(l)){t.next=7;break}return t.next=6,(0,u.unresolveComment)({id:o,websiteId:s});case 6:return t.abrupt("return",(0,c.unresolveCommentFulfilledAction)(o));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).filter(Boolean),t.ofType(c.REMOVE_COMMENT).mergeMap(function(){var e=(0,o.default)(a.default.mark((function e(t){var n,o,i,s,p,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.value.website._id,o=t.payload.ids,i=Array.isArray(o)?o:[o],e.prev=3,s=l(i),e.prev=5,s.s();case 7:if((p=s.n()).done){e.next=13;break}return d=p.value,e.next=11,(0,u.removeComment)({id:d,websiteId:n});case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),s.e(e.t0);case 18:return e.prev=18,s.f(),e.finish(18);case 21:return e.abrupt("return",(0,c.removeCommentFulfilledAction)(i));case 24:e.prev=24,e.t1=e.catch(3),console.log("remove error",e.t1);case 27:case"end":return e.stop()}}),e,null,[[3,24],[5,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()).filter(Boolean))}}).call(this,r(24))},9369:function(e,t,r){"use strict";(function(e){var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.editorStatusEpic=t.SAVING_ACTIONS=void 0;var a=n(r(36)),o=r(2357),i=r(2627),c=r(1698),u=r(392),l=r(1702),s=r(1755),p=r(1822),d=[l.UPDATE_BLOCK,l.CREATE_BLOCK,l.REMOVE_BLOCK,l.CHANGE_SORT_ORDER,l.UPDATE_TO_SOURCE,s.CHANGE_PAGE_METADATA,s.CHANGE_PAGES_METADATA_PROP,s.REMOVE_PAGE,p.CHANGE_CURRENT_PRESET,p.CHANGE_PALETTE_COLORS,s.CREATE_PAGE,p.CHANGE_CURRENT_TYPOGRAPHY,p.CHANGE_TYPOGRAPHY_SETTINGS,p.CHANGE_CURRENT_BUTTON_PRESET,p.CHANGE_BUTTON_SETTINGS];t.SAVING_ACTIONS=d;var f=d.map((function(e){return(0,c.withFulfilledType)(e)}));t.editorStatusEpic=function(t){return u.Observable.merge(t.ofType.apply(t,d).do((function(e){var t=e.type,r=e.payload;(0,o.changeEditorStatus)(i.SAVING,{type:t,payload:r})})),t.ofType.apply(t,(0,a.default)(f)).do((function(){[i.READY,i.LOADING].includes((0,o.getEditorStatus)())||(0,o.changeEditorStatus)(i.SAVED)})),t.ofType((0,c.withPermissionType)(s.READY_PAGE)).do((function(){(0,o.changeEditorStatus)(i.READY)}))).filter(e.F)}}).call(this,r(24))},9370:function(e,t,r){"use strict";var n=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrganizationEpic=void 0;var a=n(r(54)),o=n(r(55)),i=r(808),c=r(2667);t.fetchOrganizationEpic=function(e){return e.ofType(c.FETCH_ORGANIZATION).distinctUntilChanged((function(e,t){return e.id===t.id})).switchMap((0,o.default)(a.default.mark((function e(){var t,r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.getUserOrganizationsList)();case 3:if(!(r=e.sent).length){e.next=8;break}t=r[0],e.next=11;break;case 8:return e.next=10,(0,i.getOrganizationInfo)();case 10:t=e.sent;case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Couldn't get user organization info",e.t0),t={};case 17:return e.abrupt("return",(0,c.fetchOrgFulfilledAction)(t||{}));case 18:case"end":return e.stop()}}),e,null,[[0,13]])}))))}},9371:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPopupTemplatesEpic=t.default=void 0;var n=r(392),a=r(2913),o=r(544),i=function(e){return e.ofType(a.FETCH_POPUP_TEMPLATES).mergeMap((function(e){var t=e.payload.filter;return n.Observable.fromPromise((0,o.getBlockTemplates)(t)).map((function(e){return(0,a.fetchPopupTemplatesFulfilledAction)({popupTemplates:e})}))}))};t.fetchPopupTemplatesEpic=i;var c=i;t.default=c},9372:function(e,t,r){"use strict";(function(e,n){var a=r(5);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPhrasesEpic=t.default=void 0;var o=a(r(19)),i=a(r(3)),c=r(392),u=r(4306),l=r(2651),s=r(1718),p=r(1809),d=r(1817),f=r(1708),g=r(1698),v=r(1865);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=function(e){return e.reduce((function(e,t){return b(b({},e),{},(0,i.default)({},t.key,t.value))}),{})},h=e.ifElse(d.defaultLanguageSelector,d.selectLanguages,n.pipe(s.selectWebsiteLanguage,Array)),E=function(e,t){return e.ofType((0,g.withPermissionType)((0,g.withFulfilledType)(f.FETCH_PAGES)),(0,g.withPermissionType)(v.EXTERNAL_PAGE_UPDATE)).withLatestFrom(t).map(n.pipe(n.nth(1),h)).distinctUntilChanged().switchMap(n.unary(c.Observable.from)).withLatestFrom(t).mergeMap((function(e){var t=(0,o.default)(e,2),r=t[0],n=t[1],a=(0,s.selectWebsiteId)(n);return Promise.all([(0,u.loadDefaultPhrases)(r),(0,l.loadPhrases)(a,r).then(O)]).then((function(e){var t=(0,o.default)(e,2),r=t[0],n=t[1];return b(b({},r),n)})).then((function(e){return(0,p.fetchPhrasesFulfilledAction)(r,e)}))}))};t.fetchPhrasesEpic=E;var m=E;t.default=m}).call(this,r(35),r(24))},9373:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.pageReadyEpic=t.default=void 0;var n=r(1708),a=r(3648),o=r(2031),i=r(392),c=r(1756),u=r(2032),l=r(2459),s=function(t,r){return t.ofType(n.READY_PAGE).mergeMap((function(){var t,n=r.value,o=(0,c.getCurrentPage)(n),s=Object.values((0,l.selectBlocksWithLayoutWithoutHiddenAndRemoved)(n)).sort((function(e,t){return Number((0,u.isBlockBelongsToPage)(o,e))-Number((0,u.isBlockBelongsToPage)(o,t))})),p=null===(t=e.first(s))||void 0===t?void 0:t.id;return i.Observable.of((0,a.startBlocksLoadingAction)(p))}))};t.pageReadyEpic=s;var p=(0,o.combineEpics)(s);t.default=p}).call(this,r(24))},9374:function(e,t,r){"use strict";var n=r(5),a=r(17);Object.defineProperty(t,"__esModule",{value:!0}),t.setLastCustomShapeTypeEpic=t.getLastCustomShapeTypeEpic=t.default=void 0;var o=n(r(54)),i=n(r(19)),c=n(r(55)),u=r(2031),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(n,i,c):n[i]=e[i]}n.default=e,r&&r.set(e,n);return n}(r(3055)),s=r(2721),p=r(2034),d=r(3024),f=r(1718);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}var v=function(e){return e.ofType(s.FETCH_LAST_CUSTOM_SHAPE_TYPE).switchMap(function(){var e=(0,c.default)(o.default.mark((function e(t){var r,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload.id,e.next=3,l.getItem({id:r,key:p.LAST_CUSTOM_SHAPE_TYPE});case 3:return n=e.sent,e.abrupt("return",(0,d.fetchLastCustomShapeTypeFulfilledAction)(n||p.DEFAULT_CUSTOM_SHAPE_TYPE));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())};t.getLastCustomShapeTypeEpic=v;var y=function(e,t){return e.ofType(s.SET_LAST_CUSTOM_SHAPE_TYPE).withLatestFrom(t).switchMap(function(){var e=(0,c.default)(o.default.mark((function e(t){var r,n,a,c;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,i.default)(t,2),n=r[0].payload.value,a=r[1],c=(0,f.selectWebsiteId)(a),l.setItem({id:c,key:p.LAST_CUSTOM_SHAPE_TYPE,value:n}),e.abrupt("return",(0,d.setLastCustomShapeTypeFulfilledAction)(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())};t.setLastCustomShapeTypeEpic=y;var b=(0,u.combineEpics)(v,y);t.default=b}}]);